<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../casper-epaper/casper-epaper-imports.html">

<dom-module id="casper-epaper">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <canvas width="[[width]]" height="[[height]]" id="canvas"></canvas>
  </template>

  <script>

    Polymer({
      is: 'casper-epaper',
      properties: {
        width: {
          type: Number,
          value: 595
        },
        height: {
          type: Number,
          value: 842
        },
        url: {
          type: String,
          value: undefined
        },
        port: {
          type: String,
          value: undefined
        },
        asset_url: {
          type: String,
          value: undefined
        },
        asset_digest: {
          type: String,
          value: undefined
        },
        asset_debug: {
          type: Boolean,
          value: false
        }
      },

      ready: function () {
        this.calculate_attribute_defaults();
        this._epaper = new EPaper(this.url, this.port, this.uri, this.$.canvas, undefined, this.asset_url, this.asset_digest);
      },

      attached: function() {
        console.log("Hello my name is paper");
      },

      /**
       * @brief Assing defaults to undefined component attributes
       */
      calculate_attribute_defaults: function () {
        if ( this.url === undefined ) {
          if ( window.location.protocol === "https:" ) {
            this.url = "wss://" + window.location.hostname;
          } else {
            this.url = "ws://" + window.location.hostname;
          }
        }
        this.port = this.port || window.location.port;
        this.uri  = this.uri  || 'epaper';
        if ( this.asset_url === undefined ) {
          this.asset_url = this.resolveUrl('casper-epaper.html').replace('casper-epaper.html','assets') + '/';
        }
        this.asset_digest = this.asset_digest || '';
      },

    });
  </script>
</dom-module>
